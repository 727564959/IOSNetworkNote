# MIME

描述并标记多媒体内容，web服务器会为所有HTTP对象数据（图片、音频文件、视频..）附加一个MIME类型

MIME类型是一种文本标记，表示一种主要的对象类型和一个特定的子类型。

| 数据类型           | MIME类型                      |
| ------------------ | ----------------------------- |
| HTML文档           | text/html                     |
| ASCII文本文档      | Text/plain                    |
| JPEG               | Image/jpeg                    |
| GIF                | Image/gif                     |
| QuickTime电影      | Video/quiketime               |
| PowerPoint演示文件 | Application/vnd.ms-powerpoint |

# URI 统一资源标识符

## URL 统一资源定位符

- 方案

  URL的第一部分，告知web客户端怎样访问资源。

- 地址

  URL的第二部分，告知web客户端资源位于何处。

- 资源

  URL的第三部分，说明请求服务器上哪个特定的本地资源。

## 基础URL

基础的URL是作为相对URL的参考点使用的。可以来自以下不同的地方

- 在资源中显式提供
- 封装资源的基础URL
- 没有基础URL

## NSURL

## NSURLRequest

# HTTP报文

HTTP应用程序之间发送的数据块,基于文本传输。

## 请求报文

- ##### 格式

  起始行			<method><request-URL><version>

  首部字段		<headers>

  主体				<ebtity-body>

## 响应报文

- ##### 格式

  起始行			<version><status><reason-phrase>

  首部字段		<headers>

  主体				<ebtity-body>

## 方法

| 方法    | 描述                                               | 是否包含主体 |
| ------- | -------------------------------------------------- | ------------ |
| GET     | 从服务器获取一份文档                               | 否           |
| POST    | 向服务器发送需要处理的数据                         | 是           |
| HEAD    | 从服务器获取文档的首部                             | 否           |
| PUT     | 将请求的主体部分存储在服务器上                     | 是           |
| TRACE   | 对可能经过代理服务器传送到服务器上去的报文进行追踪 | 否           |
| OPTIONS | 决定可以在服务器上执行哪些方法                     | 否           |
| DELETE  | 从服务器上删除一份文档                             | 否           |



## 状态码

| 范围 | 分类       |
| ---- | ---------- |
| 1XX  | 信息提示   |
| 2XX  | 成功       |
| 3XX  | 重定向     |
| 4XX  | 客户端错误 |
| 5XX  | 服务器错误 |

## HTTP首部

1. ### 通用首部

   1. 通用信息首部

      > Connection		允许客户端和服务器指定与请求/响应连接有关的选项
      >
      > Date					提供日期和时间
      >
      > MIME-Version	 给出发送端的MIME版本
      >
      > Transfer-Encoding	告知接受端报文的编码方式

      

   2. 通用缓存首部

      > Cache-Control	用于随报文传送缓存指示
      >
      > Prama				 另一种随报文传送指示的方式，但不专用于缓存

      

2. ### 请求首部

   1. 请求信息性首部

      > User-Agent		将发起请求的应用程序名称告知服务器

   2. Accept首部

      > Accept						告诉服务器能发送的媒体类型
      >
      > Accept-Charset		  告诉服务器能发送的字符集类型
      >
      > Accept-Encpding	   告诉服务器能发送的编码方式

   3. 条件请求首部

      > Expect							允许客户端列出某请求所要求的服务器行为
      >
      > If-Mathc						 如果实体标记与文档当前的实体标记相匹配，就获取这个文档
      >
      > If-Modified-Since		   除非在某个指定的日清之后资源被修改过，否则就限制这个请求
      >
      > If-Range						 允许对文档的某个范围进行条件请求
      >
      > Range							如果服务器支持范围请求，就请求资源的指定范围

   4. 安全请求首部

      > Authorization				包含客户端提供给服务端，以便对其自身进行认证的数据
      >
      > Cookie						  客户端用它向服务端传送一个令牌
      >
      > Cookie2						用来说明请求端支持的cookie版本

   5. 代理请求首部

      > Max-Forward				转发给其他代理或网关的最大次数
      >
      > Proxy-Authorization	  与代理进行认证时使用
      >
      > Proxy-Connection		与代理进行连接时使用

3. ### 响应首部

   1. 响应信息性首部

      > Age			  响应持续时间
      >
      > Public		   服务器为其资源支持的请求方法列表
      >
      > Retry-After   如果资源不可用，在此日期或时间重试
      >
      > Server 		 服务器应用软件的名称和版本
      >
      > Title			  HTML文档源端给出的标题

   2. 协商首部

      > Accept-Ranges 	 服务器可接受的范围类型
      >
      > Vary						服务器查看其它首部的列表

   3. 安全响应首部

      > Proxy-Authenticate	代理对客户端的质询列表
      >
      > Set-Cookie				给客户端设置一个令牌
      >
      > Set-Cookie2		
      >
      > WWW-Authenticate	服务器对客户端的质询列表

4. ### 实体首部

   告知报文接受者对什么进行处理。

   1. 实体信息首部

      > Allow		列出了可以对此实体执行的请求方法	
      >
      > Location	告知客户端实体实际位于何处，用于将接收端定向到资源的位置上去

   2. 内容首部

      > Content-Base				解析主体中相对URL时使用的基础URL
      >
      > Content-Encoding		 对主体执行的任意编码方式
      >
      > Content-Range			  在整个资源中此实体表示的字节范围
      >
      > Content-Type				 这个主体的对象类型
      >
      > Content-Location		  资源实际所处位置

   3. 实体缓存首部

      > ETag							与此实体相关的实体标记
      >
      > Expires						实体不再有效，要从原始的源端再次获取此实体的日期和时间
      >
      > Last-Modified			  实体最后一次被修改的时间

5. ### 扩展首部

# http的结构组件

- ## 代理

  代理服务器，web安全、应用集成以及性能优化的重要组成模块。是代表客户端完成事务处理的中间人。

  ### 代理URL与主机URL

  没有设置客户端使用代理是会发送部分URL，反之发送完整URL。

  ### via首部

- ## 缓存

  一种特殊的HTTP代理服务器，可将代理传送的常用文档复制保存。

- ## 网关

  一种特殊服务器，做为其它服务器的中间实体使用，通常用于将HTTP流量转换成其它协议。

  它可以做为某种翻译器使用，它抽象出了一种能够到达资源的方法。

  ##### 服务器网关

  通过HTTP与客户端对话，通过其他协议与服务器通信。

  ##### 客户端网关

  通过其他协议与客户端对话，通过HTTP与服务器通信。

  ### CGI

  通用网关接口，是一个标准接口集，web服务器可以用它来装载程序以响应对特定URL的HTTP请求。

- ## 隧道

  通过加密实现盲转发。可以通过HTTP应用程序访问非HTTP应用程序。此连接只是对原始字节进行转接，不再是报文的承载着，所以不需要使用内容类型了。

  ### CONNECT方法

  web隧道是HTTP的CONNECT方法建立的，CONNECT方法是一种得到广泛应用的扩展。

- ## agent代理

  代表用户发起HTTP请求的客户端程序（如web浏览器）。

# TCP性能影响

1. ### 握手连接时延

   小的HTTP事务可能会在TCP的建立上花费50%的时间。

2. ### 延迟确认

   TCP连接会在每个段的接收者收到完好的段时，回送一个确认报文。由于确认报文很小，所以TCP允许在发往相同方向的输出数据和返回的确认报文结合在一起，有效运用网络。

   延迟算法指在特定的窗口时间内将输出确认放在缓存区中，等待能够捎带它的数据，窗口时间后，将确认信息放在单独的分组中传送。

   由于HTTP协议的应答行为降低了捎带信息的可能，延迟算法会引入较大时延。

3. ### TCP慢启动

   TCP的慢启动机制会使新连接的传输速度慢于已经交换过一定数据的连接。

4. ### Nagle算法与_NODEDELAY

   Nagle算法试图在发送一个分组前，将大量的TCP数据绑定在一起，提高网络利用率。

   Nagle对HTTP性能的影响原因与延时算法类似。

5. ### TIME_WAIT累计与端口耗尽

   客户端在断开连接时，为了防止创建具有相同地址和端口号的新连接，会继续占用端口2MSL，若是频繁绑定端口进行连接可能会导致端口耗尽。

# HTTP连接



## Connection首部

两个相邻的HTTP应用程序会为它们共享的连接应用一组选项，connection首部字段中有一个由逗号分隔的连接标签，这些标签为此连接指定了一些不会传播到其他连接去的选项。

connection首部可以承载3种不同类型的标签：1、HTTP首部字段名	2、任意标签值 	3、close值。

如果连接包含一个HTTP首部字段名称，在转发出去前，必须将其全部删除。

HTTP应用程序收到一条带有connection首部的报文时，接收端会解析发送端请求的所有选项，并将其应用。然后会在报文转发给下一跳前，删除connection首部以及connection列出的所有首部。



## 并行连接

客户端打开多条连接，并行的执行HTTP事务。

### 局限

如果客户端网络带宽不足时，一个连接到速度较快服务器上的HTTP事务会很容易地耗尽可用带宽，不会提升响应速度。

大量连接会消耗很多内存资源，从而引发自身性能问题，因此需要对其总数进行限制，且服务器可以随意关闭特定客户端的超量连接。



## 持久连接 

允许HTTP设备在事务处理结束后将TCP连接保持在打开状态，以便未来的HTTP请求重用此连接。

### keep-alive(HTTP/1.0+)

##### 哑代理

即中间代理无法处理Keep-Alive字段（盲中继），直接将其转发给服务器，造成服务器后续无法接收到客户端发送的数据。

### proxy-connection

服务器端会直接忽略掉此首部，可以处理这个首部的代理在处理完成后，用connection首部取代此首部，转发给服务器。

但此方法无法解决一次连接在转发到服务器前，依次转发到盲中继与非盲中继上。

### persistent(HTTP/1.1)



## 管道化连接

在持久连接上可选用的使用请求管道，在响应到达前，可将多条请求放入队列。

## 关闭连接

HTTP客户端、服务器或代理都可以在任意时刻关闭一条TCP传输连接。

由于连接可以随时关闭，如果管道化连接在收到返回结果前关闭了，客户端无法准确判断服务器端激活了多少事务，故非幂等请求（POST）不应该使用管道化连接。

幂等：一个事务不管执行多少次得到的结果相同。

